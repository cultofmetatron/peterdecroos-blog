<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>lets build a backbone based framework!! - console.blog( this.thought )</title>
	<meta name="author" content="Peter de Croos">

	
	<meta name="description" content="I&#8217;ve been building large scale applications in Backbone for about 8 months now.
In that time I&#8217;ve used throax as well as building custom &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="console.blog( this.thought )" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">console.blog( this.thought )</a></h1>
<nav id="main-nav"><ul class="main">
  <li><a href="/">Blog</a></li>
  <li><a href="/about-me">About</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
  <li><a href="/">Blog</a></li>
  <li><a href="/about-me">About</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:blog.peterdecroos.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
		<a class="github" href="https://github.com/cultofmetatron" title="GitHub">GitHub</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:blog.peterdecroos.com">
	</form>
</nav>

</header>
	
	<div id="content" class="inner"><article class="post">
	<h1 class="title">Lets Build a Backbone Based Framework!!</h1>
	<div class="entry-content"><p>I&#8217;ve been building large scale applications in Backbone for about 8 months now.
In that time I&#8217;ve used thorax as well as building custom solutions in backbone.</p>

<p>Last night, I live coded the creation of a demo backbone framework similar in features
to Thorax. I&#8217;m going to walk you through how
I&#8217;ve solved architectural problems in contructing a large scale backbone framework.</p>

<p><a href="https://github.com/cultofmetatron/backbone-framework-example">Fork or watch it here</a></p>

<p>When building a large scale Backbone, there are several consderations to consider.</p>

<ul>
<li>How are we going to have templates load? Inline html declarations in the views do not scale</li>
<li>how do we handle render?</li>
<li>how do we handle child views?</li>
</ul>


<p>By default, backboneView.render() is a noop. Its meant to be overidden. Backbone.Events gives us
a nice set of methods to allow Backbone objects to listenTo() events off each other, However, the
actual bindings and callbacks are left to the implimenter.</p>

<h3>Loading Templates</h3>

<p>the first thing is figure out how we want the templates to load. If using a tool like require.js
or browserify, there are plugins for automatically compiling templates and sending to the client
just a compiled template function we can plug into out view. Since I&#8217;m trying to keep it simple,
the easiest way to get templates is to wrap your templates in a script tag. To prevent the browser
from executing it as javascript, we add a type that is not &#8216;text/javascript&#8217;.</p>

<p>I like to use &#8220;text/template.&#8221;</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/template&quot;</span> <span class="na">data-name=</span><span class="s">&quot;templateName&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">template</span> <span class="nx">contents</span> <span class="nx">goes</span> <span class="nx">here</span> <span class="o">--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Transforming these into working templates is fairly straightforward. For each
script tag with type=&#8221;text/template&#8221;, run the template compiler over the html inside and
store it somewhere. In this case I add a data-name attribute which will be the key for the
hash I store the compiled template in.</p>

<p><a href="https://github.com/cultofmetatron/backbone-framework-example/blob/master/public/javascripts/init.js">/public/javascripts/init.js</a></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="nb">window</span><span class="p">.</span><span class="nx">templates</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">$sources</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;script[type=&quot;text/template&quot;]&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">$sources</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">$el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">templates</span><span class="p">[</span><span class="nx">$el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">());</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this version, I chose to use express + jade, Of course writing underscore templates
in jade seemed a little odd so I delegated those to jade&#8217;s include statement. I know there
are projects like jade-browserify so maybe I&#8217;ll eventually update this using just jade.</p>

<p><a href="https://github.com/cultofmetatron/backbone-framework-example/blob/master/views/layout.jade">/views/layout.jade</a></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='jade'><span class='line'><span class="nt">doctype</span> html
</span><span class='line'><span class="nt">html</span>
</span><span class='line'>  <span class="nt">head</span>
</span><span class='line'>    <span class="nt">title</span><span class="p">=</span> <span class="n">title</span>
</span><span class='line'>    <span class="nt">link</span>( <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="err">,</span> <span class="na">href=</span><span class="s">&#39;/components/bootstrap/dist/css/bootstrap.css&#39;</span>)
</span><span class='line'>    <span class="nt">link</span>( <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="err">,</span> <span class="na">href=</span><span class="s">&#39;/stylesheets/style.css&#39;</span>)
</span><span class='line'>    <span class="nt">script</span>( <span class="na">src=</span><span class="s">&quot;/components/jquery/jquery.js&quot;</span>)
</span><span class='line'>    <span class="nt">script</span>( <span class="na">src=</span><span class="s">&quot;/components/bootstrap/dist/js/bootstrap.js&quot;</span>)
</span><span class='line'>    <span class="nt">script</span>( <span class="na">src=</span><span class="s">&quot;/components/underscore/underscore.js&quot;</span>)
</span><span class='line'>    <span class="nt">script</span>( <span class="na">src=</span><span class="s">&quot;/components/backbone/backbone.js&quot;</span>)
</span><span class='line'>    <span class="nt">script</span>( <span class="na">src=</span><span class="s">&quot;/javascripts/base.js&quot;</span>)
</span><span class='line'>    <span class="nt">script</span>( <span class="na">src=</span><span class="s">&quot;/javascripts/application.js&quot;</span>)
</span><span class='line'>  <span class="nt">body</span>
</span><span class='line'>    <span class="nt">block</span> content
</span><span class='line'>    <span class="nt">script</span>(<span class="na">type=</span><span class="s">&quot;text/template&quot;</span><span class="err">,</span> <span class="na">data-name=</span><span class="s">&quot;main&quot;</span>)
</span><span class='line'>      <span class="nt">include</span> templates/main.html
</span><span class='line'>    <span class="nt">script</span>(<span class="na">type=</span><span class="s">&quot;text/template&quot;</span><span class="err">,</span> <span class="na">data-name=</span><span class="s">&quot;header&quot;</span>)
</span><span class='line'>      <span class="nt">include</span> templates/header.html
</span><span class='line'>    <span class="nt">script</span>(<span class="na">type=</span><span class="s">&quot;text/template&quot;</span><span class="err">,</span> <span class="na">data-name=</span><span class="s">&quot;menuLinks&quot;</span>)
</span><span class='line'>      <span class="nt">include</span> templates/menulink.html
</span><span class='line'>    <span class="nt">script</span>( <span class="na">src=</span><span class="s">&quot;/javascripts/init.js&quot;</span>)
</span></code></pre></td></tr></table></div></figure>


<p>The actual contents of the underscore templates in the *.html templates will
now be compiled and loaded into &#8220;templates[data-name]&#8221; where I can access it later.</p>

<h3>Creating our own Base Backbone Objects.</h3>

<p>The first thing we want to do is determie the shared behavior of backbone objects
in our app. For special cases we can overide them later. However, for the sake of time, we
want some decalrative way of telling the object what template to use and a default render()
method that we can use in most situations.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="c1">//first we declare a namespace to store these new Objects</span>
</span><span class='line'>  <span class="nx">application</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="nx">application</span><span class="p">.</span><span class="nx">BaseView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="cm">/*</span>
</span><span class='line'><span class="cm">        if the BaseView is extended with a tpl string, we want to </span>
</span><span class='line'><span class="cm">        have that be available but we also want to be able to load </span>
</span><span class='line'><span class="cm">        it at runtime and have it overide the base tpl string</span>
</span><span class='line'><span class="cm">      */</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">tpl</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">tpl</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">tpl</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">loadTemplate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tpl</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">loadTemplate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tpl</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="cm">/*  </span>
</span><span class='line'><span class="cm">        if tpl is a function, we assign it directly, </span>
</span><span class='line'><span class="cm">        otherwise, if its a string, we look it up</span>
</span><span class='line'><span class="cm">        in our templates map.</span>
</span><span class='line'><span class="cm">      */</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">tpl</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">tpl</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">tpl</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">template</span> <span class="o">=</span> <span class="nx">template</span><span class="p">[</span><span class="nx">tpl</span><span class="p">];</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;tpl must be a function or a string!&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">//see below</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next up we need to create a render function. Its arbitrary based on the particular
needs of your application. For most purposes however, Its sufficiant to make a
view&#8217;s model&#8217;s attributes available inside the templates.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="c1">//from the render in the preceeding example</span>
</span><span class='line'>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span><span class="c1">//empty the view&#39;s node</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">//create a context object</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">context</span><span class="p">));</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&#8217;s a great first start. Now any View that extends BaseView will have a
render. The only interface we must follow is that the View have a model
and a tpl which tells the View how to resolve this.template.</p>

<p>Of course there&#8217;s a major component missing. Any good backbone framework
has a way of embedding subViews. Turns out its sort of tricky.</p>

<p>The Lifecycle of a Backbone view in this case is to listen to changes on
model and call render() which updates the view&#8217;s $el property. Thus its
impossible to proceed until this.$el is completely demystified.</p>

<h4>what is $el?</h4>

<p>I&#8217;ve heard alot of confusion about the nature of &#8216;this.$el&#8217;. Typically, a Backbone
View is a controller for a node. This node is a structure relevant to the
document object model.</p>

<p>you may be familiar with a dom object if you&#8217;ve used jquery.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="kd">var</span> <span class="nx">$body</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">);</span> <span class="c1">// =&gt; returns a jquery wrapped object</span>
</span><span class='line'>  <span class="nx">$body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">//returns the wrapped object representing the body dom node.</span>
</span></code></pre></td></tr></table></div></figure>


<p>In much the same way, a backbone view is a controller for a dom object.</p>

<p>You may have seen the kickstart for a backbone app that involves doing a jquery
lookup on a node and setting its html to your view&#8217;s $el property</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="kd">var</span> <span class="nx">$container</span> <span class="o">=</span>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.container&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">$container</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">$el</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Assuming the render() method of the view returns &#8216;this&#8217;, then calling it before calling the
$el property guarantees that the dom object managed by the view will be updated before being
placed in the dom. When render() is called again, it updates the <em>contents</em> of that $el. The
$container has a reference to $el stored in it thus ensuring that calling render() will change
the webpage to reflect the latest state of the model.</p>

<h4>Extending out Render() to support subViews.</h4>

<p>With the afformentioned definition of $el in mind, The best way to embed a subview
(with string based template engines, you do something else with dom based ones.) is to do an
initial render of the dom node marking off somehow places to embed subviews. Then afterwards,
go back through the $el and systematically embed $el for each subview in their respective places.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="c1">//updated render()</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">_subView</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="s1">&#39;&lt;div class=&quot;subView view-&#39;</span> <span class="o">+</span> <span class="nx">viewName</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">//pop it in the dom</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">context</span><span class="p">));</span>
</span><span class='line'>  <span class="c1">//notice we do this AFTER we rerender the new this.$el</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">subViews</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">subViews</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.subView&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">$el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">// view-</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">subView</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">)).</span><span class="nx">chain</span><span class="p">()</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">className</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="p">(</span><span class="nx">className</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^view-/</span><span class="p">));</span>
</span><span class='line'>      <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">className</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>      <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="nx">value</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">//grab the first item</span>
</span><span class='line'>    <span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">subViews</span><span class="p">[</span><span class="nx">subView</span><span class="p">].</span><span class="nx">render</span><span class="p">().</span><span class="nx">$el</span><span class="p">);</span>
</span><span class='line'>  <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>There&#8217;s a new things we&#8217;ve added to this version.</p>

<ol>
<li>There is now a &#8216;subView()&#8217; helper being passed into context, this will generate
the slug that we will look for when embedding a subview.</li>
<li>After the $el is rendered, we are searching for dom elements with class subview</li>
<li>for each subView, we find the name of the subview we embed in there given as
view-[viewName] and look it up in the view&#8217;s subViews key/val lookup object.
Its a property of teh parent view.</li>
</ol>


<p>With this, we now have an easy way of supporting subviews.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="nx">childView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">application</span><span class="p">.</span><span class="nx">BaseView</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">tpl</span><span class="o">:</span> <span class="s1">&#39;child&#39;</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">parentView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">application</span><span class="p">.</span><span class="nx">BaseView</span><span class="p">({</span>
</span><span class='line'>    <span class="nx">tpl</span><span class="o">:</span> <span class="s1">&#39;parent&#39;</span>
</span><span class='line'>    <span class="nx">subViews</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">child</span><span class="o">:</span> <span class="nx">childView</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.container&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">parentView</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">$el</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>In parentView&#8217;s template, its as simple as using out new subView helper</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/template&quot;</span> <span class="na">date-name=</span><span class="s">&quot;parent&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;%=</span> <span class="nx">_subView</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">)</span> <span class="o">%&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/template&quot;</span> <span class="na">date-name=</span><span class="s">&quot;child&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span> <span class="nx">hi</span> <span class="nx">I</span><span class="err">&#39;</span><span class="nx">m</span> <span class="nx">the</span> <span class="nx">child</span> <span class="nx">view</span><span class="o">!!</span> <span class="o">&lt;</span><span class="err">/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the next installment in this series, we&#8217;ll build a base ControllerView class which we
can use to render generic collections. Yes, they&#8217;ll be embedable as subviews in our BaseView.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-06T13:57:00-08:00" pubdate data-updated="true">Jan 6<span>th</span>, 2014</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/backbone/'>backbone</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>


</div>
	
		<span class="comments"><a href="/blog/2014/01/06/lets-build-a-backbone-based-framework/#disqus_thread">Comments</a></span>
	
</div></article>
<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>

  <div style="float: right" class='angellist_embed' data-user_id='277748'>  <a href='https://angel.co/peter-de-croos?utm_medium=web&utm_campaign=individual_embed&utm_content=277748'></a></div><script type='text/javascript' src='https://angel.co/peter-de-croos/embed/angellist.js'></script>



</div>


<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Peter de Croos

<div>
<a href="https://angel.co/peter-de-croos?follow=1&type=User&id=277748"></a><script src="https://angel.co/javascripts/embed.js" type="text/javascript"></script>
</div>
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'peterdecroosblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://blog.peterdecroos.com/blog/2014/01/06/lets-build-a-backbone-based-framework/';
        var disqus_url = 'http://blog.peterdecroos.com/blog/2014/01/06/lets-build-a-backbone-based-framework/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-33062340-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>





</body>
</html>
